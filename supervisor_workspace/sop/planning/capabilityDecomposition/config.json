{
  "identifier": "capabilityDecomposition",
  "name": "能力拆解 & 契约单元定义",
  "stage": "planning",
  "description": "把完成API所需的能力落为契约单元，只定签名+语义，不写真实逻辑",
  "outputs": [
    {
      "output_id": "56a0cee3-07b9-4e11-a036-ee1d5e2e23f1",
      "name": "契约单元源码",
      "description": "带标签与docstring的契约单元函数/类定义",
      "path": "src/contracts/",
      "type": "FOLDER",
      "template_filename": null
    },
    {
      "output_id": "b11ebd5e-e08d-40bd-8948-c5a2ad5bf5d3",
      "name": "数据传输对象",
      "description": "API输入输出的DTO定义",
      "path": "src/dto/",
      "type": "FOLDER",
      "template_filename": null
    },
    {
      "output_id": "2f485c37-95d7-47c4-b2db-4115e4d2df99",
      "name": "契约单元清单",
      "description": "所有契约单元的汇总文档",
      "path": "docs/CONTRACT_UNITS.md",
      "type": "FILE",
      "template_filename": "contract-units.md"
    }
  ],
  "rules": [
    {
      "name": "契约单元定义规范",
      "when_condition": "创建契约单元时",
      "must": [
        "每个契约单元必须有清晰的函数/类签名",
        "docstring必须包含前置条件、后置条件、不变量、错误语义",
        "所有契约单元必须打上成熟度标签（初始为STUB）",
        "契约单元命名应清晰表达其能力和职责",
        "单一职责原则：每个契约单元只负责一个明确的能力",
        "接口隔离：不同能力的契约单元应相互独立",
        "依赖倒置：依赖抽象而非具体实现"
      ],
      "must_not": [
        "不得创建没有成熟度标签的契约单元",
        "不得省略docstring中的错误语义描述",
        "不得创建职责过于复杂的契约单元",
        "不得在契约单元中包含具体的实现逻辑",
        "不得忽略边界条件和异常情况的定义"
      ]
    },
    {
      "name": "数据传输对象设计",
      "when_condition": "需要结构化输入输出时",
      "must": [
        "优先使用TypedDict或dataclass定义数据结构",
        "如需验证可使用极简Pydantic模型",
        "输入DTO使用extra='forbid'严格验证",
        "输出DTO使用ignore忽略额外字段",
        "DTO命名应清晰表达数据的用途和上下文",
        "复杂数据结构应适当嵌套而不是扁平化"
      ],
      "must_not": [
        "不得在初期就引入复杂的验证器",
        "不得创建过于复杂的Schema管控",
        "不得忽略数据类型的明确定义",
        "不得使用模糊的字段命名"
      ]
    },
    {
      "name": "成熟度标签管理",
      "when_condition": "管理契约单元生命周期时",
      "must": [
        "使用装饰器在对象上写入__impl__.maturity",
        "成熟度必须为STUB、FAKE、REAL之一",
        "每个标签都应包含notes说明当前状态和计划",
        "标签更新应反映实际的实现状态",
        "保持标签与代码实际状态的一致性"
      ],
      "must_not": [
        "不得使用标准以外的成熟度标签",
        "不得省略notes字段的说明",
        "不得标签与实际实现状态不一致",
        "不得忽略标签的更新维护"
      ]
    }
  ],
  "step_id": "65c53168-ff47-425f-8f7a-98369db8e71e"
}