{
  "identifier": "compositionPath",
  "name": "组合路径 & 骨架跑通",
  "stage": "implementing",
  "description": "验证管道连通、形状正确。编排契约单元，写skeleton测试确认流程能跑通",
  "outputs": [
    {
      "output_id": "564dc1ab-2371-4dff-ad35-0c4b142977bb",
      "name": "API实现",
      "description": "在api模块中编排契约单元的胶水逻辑",
      "path": "src/api/",
      "type": "FOLDER",
      "template_filename": null
    },
    {
      "output_id": "dec2627e-51ff-4867-b567-9c32555c986f",
      "name": "skeleton测试",
      "description": "无断言或最小哨兵断言的临时E2E测试",
      "path": "tests/e2e/test_skeleton*.py",
      "type": "PATTERN",
      "template_filename": null
    },
    {
      "output_id": "57424a89-7e32-4814-8a49-ad9be456e19c",
      "name": "测试配置",
      "description": "pytest配置标记skeleton测试",
      "path": "pytest.ini",
      "type": "FILE",
      "template_filename": "pytest.ini"
    }
  ],
  "rules": [
    {
      "name": "API编排实现",
      "when_condition": "组合契约单元为完整API时",
      "must": [
        "在api模块中编写胶水逻辑组合契约单元",
        "保持API层的薄化，主要逻辑在契约单元中",
        "正确处理契约单元之间的数据流转",
        "实现适当的错误传播和转换",
        "确保API接口符合上游冻结的契约",
        "添加必要的日志记录点",
        "实现请求响应的格式转换"
      ],
      "must_not": [
        "不得在API层实现复杂的业务逻辑",
        "不得绕过契约单元直接实现功能",
        "不得忽略错误处理和异常传播",
        "不得省略关键的数据验证步骤"
      ]
    },
    {
      "name": "skeleton测试设计",
      "when_condition": "验证流程连通性时",
      "must": [
        "使用@pytest.mark.skeleton标记测试",
        "测试应验证流程能完整跑通",
        "对于STUB使用异常型或形状型验证",
        "异常型STUB应在边界抛出NotImplementedError",
        "形状型STUB应返回带明显标记的哨兵值",
        "哨兵值应保持数据结构正确但内容明显为假",
        "测试应覆盖主要的API调用路径",
        "保持测试的简洁性，避免复杂的断言"
      ],
      "must_not": [
        "不得在skeleton测试中添加复杂的业务断言",
        "不得期望skeleton测试验证正确性",
        "不得忽略异常流程的skeleton测试",
        "不得在skeleton测试中依赖外部系统"
      ]
    },
    {
      "name": "测试标记和配置",
      "when_condition": "配置测试执行策略时",
      "must": [
        "在pytest.ini中正确配置skeleton标记",
        "skeleton测试默认不进入CI流水线",
        "提供本地执行skeleton测试的命令",
        "文档化skeleton测试的目的和使用方法",
        "确保skeleton测试的独立性",
        "设置合适的测试超时时间"
      ],
      "must_not": [
        "不得让skeleton测试默认在CI中执行",
        "不得让skeleton测试依赖特定的运行环境",
        "不得在skeleton测试中使用真实的外部资源",
        "不得忽略skeleton测试的维护"
      ]
    }
  ],
  "step_id": "eb828928-8173-433e-9609-00bf059f40ce"
}